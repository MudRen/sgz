// job.c used for player to check the job stuation
// by fire on November 14, 1998
void start(string arg)
{
  object o_id;
  string *jobs;
  if((arg=="")||(!arg))
     o_id=this_body();
  else
  {
     if(!wizardp(this_body()))
     {
 	write("只有巫师才可检查他人的工作情况．\n");
	return;
     }
     o_id=find_body(arg);
     if(!objectp(o_id))
     {
 	write("找不到这个人．\n");
	return;
     }
  }
  jobs=o_id->query_job("list");
  if(sizeof(jobs)==0)
  {
      write("未查到任何工作纪录．\n");
      return;
  }
  write("名称　完成次数　当天次数　状态  时间(已用或上次完成)　参数\n");
  write("〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓〓\n");
  foreach(string jb in jobs)
  {
      string name,count,lastcount,statue,lasttimes,para;
      int p_time;
      name=JOB_D->get_job(jb,"name");
      count=chinese_number(o_id->query_job(jb,"count"));
      lastcount=chinese_number(o_id->query_job(jb,"count_lasttimes"));
      p_time=o_id->query_job(jb,"beg_time");     
      statue=(p_time>0 ? "执行" : "完成");
      if(!p_time)
	p_time=o_id->query_job(jb,"finish_time");
      p_time=(time()-p_time)/60;
      if(p_time>999)
          lasttimes="很久以前";
      else
          lasttimes=chinese_number(p_time)+"分";
      para=o_id->query_job(jb,"paraname");
      printf("%-6s%-10s%-10s%-6s%10s%s",name,count,lastcount,statue,lasttimes,para);
  }
}
